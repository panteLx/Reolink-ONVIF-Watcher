services:
  onif-watcher:
    build: .
    container_name: reolink-watcher
    restart: unless-stopped

    environment:
      - TZ=Europe/Berlin

    volumes:
      - recordings:/app/recordings
      - ./cameras.json:/app/cameras.json:ro

    # Netzwerk-Modus (host empfohlen für RTSP-Streams)
    network_mode: host

    # Ressourcen-Limits (empfohlen für 4 Kameras in LXC Container)
    deploy:
      resources:
        limits:
          cpus: "3.0" # 4 Kameras: ~0.5-0.75 CPU pro Kamera für H.264/H.265 Stream-Copy
          memory: 2048M # 4 Kameras: ~400-500MB pro Kamera + Overhead
        reservations:
          cpus: "1.0" # Garantierte CPU-Ressourcen
          memory: 512M # Garantierter RAM

    # Logging-Konfiguration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  recordings:
