services:
  onif-watcher:
    build: .
    container_name: reolink-watcher
    restart: unless-stopped

    # Umgebungsvariablen aus .env Datei
    environment:
      - CAMERA_HOST=${CAMERA_HOST}
      - CAMERA_USERNAME=${CAMERA_USERNAME}
      - CAMERA_PASSWORD=${CAMERA_PASSWORD}
      - CAMERA_PORT=${CAMERA_PORT:-80}
      - CAMERA_CHANNEL=${CAMERA_CHANNEL:-0}
      - SNAPSHOT_DIR=/app/recordings/snapshots
      - CLIP_DIR=/app/recordings/clips
      - POST_DETECTION_DURATION=${POST_DETECTION_DURATION:-15}

    # Volume-Mounts für persistente Speicherung
    volumes:
      - ./recordings:/app/recordings

    # Netzwerk-Modus (host empfohlen für RTSP-Streams)
    network_mode: host

    # Ressourcen-Limits (optional, anpassen nach Bedarf)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.25'
    #       memory: 128M

    # Logging-Konfiguration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
